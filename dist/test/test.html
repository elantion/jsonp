<html>
<head>
    <meta charset="utf-8">
    <title>Mocha Tests</title>
    <link href="https://cdn.rawgit.com/mochajs/mocha/2.2.5/mocha.css" rel="stylesheet" />
</head>
<body>
<div id="mocha"></div>
<script src="../jsonp.js"></script>
<script src="https://cdn.rawgit.com/Automattic/expect.js/0.3.1/index.js"></script>
<script src="https://cdn.rawgit.com/mochajs/mocha/2.2.5/mocha.js"></script>
<script>
    mocha.setup('bdd');
    describe('Test jsonp request: ', function() {
        let url1 = '/jsonp';
        it(url1, function(done) {
            jsonp(url1)
                .then(function(res) {
                    expect(res.name).to.be('JamesYin');
                    expect(res.number).to.be('666');
                    done();
                });
        });
        let url2 = '/jsonp?callback=load&number=1';
        it(url2, function(done) {
            jsonp(url2)
                .then(function(res) {
                    expect(res.name).to.be('JamesYin');
                    expect(res.number).to.be('1');
                    done();
                });
        });
        let url3 = '/jsonp?number=2';
        it(url3, function(done) {
            jsonp(url3)
                .then(function(res) {
                    expect(res.name).to.be('JamesYin');
                    expect(res.number).to.be('2');
                    done();
                });
        });
        let url4 = '/jsonp';
        let arg4 = {number: 4};
        it(url4 + ' and ' + JSON.stringify(arg4), function(done) {
            jsonp(url4, arg4)
                .then(function(res) {
                    expect(res.name).to.be('JamesYin');
                    expect(res.number).to.be('4');
                    done();
                });
        });
        let url5 = '/jsonp';
        let arg5 = {number: 5};
        it('Timeout test', function(done) {
            jsonp(url5, arg5)
                .timeout(1, 'timeout')
                .then(function(res) {
                    expect(res.name).to.be('JamesYin');
                    expect(res.number).to.be('5');
                })
                .catch(new Error('timeout'), function() {
                    done();
                });
        });
    });
    mocha.run();
</script>
</body>
</html>